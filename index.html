<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>BeReal Style</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.header{
  position:fixed;
  top:0;
  width:100%;
  text-align:center;
  padding:15px;
  font-weight:bold;
  font-size:20px;
  background:#000;
  z-index:10;
}

.main{
  margin-top:70px;
  width:100%;
  max-width:400px;
  aspect-ratio:9/16;
  background:#111;
  position:relative;
  overflow:hidden;
  border-radius:20px;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

.overlay-cam{
  position:absolute;
  bottom:15px;
  right:15px;
  width:110px;
  height:160px;
  border-radius:15px;
  overflow:hidden;
  border:2px solid white;
}

.time{
  position:absolute;
  bottom:10px;
  left:10px;
  font-size:14px;
  opacity:0.8;
}

.controls{
  margin-top:25px;
  display:flex;
  gap:20px;
}

button{
  padding:12px 25px;
  border-radius:30px;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

.capture{
  background:white;
  color:black;
}

.send{
  background:#1da1ff;
  color:white;
  display:none;
}

.status{
  margin-top:10px;
  font-size:14px;
  opacity:0.7;
}
</style>
</head>

<body>

<div class="header">BeReal.</div>

<div class="main">
  <video id="rearVideo" autoplay playsinline muted></video>
  <div class="overlay-cam">
    <video id="frontVideo" autoplay playsinline muted></video>
  </div>
  <div class="time" id="time"></div>
</div>

<div class="controls">
  <button class="capture" id="captureBtn">Capture</button>
  <button class="send" id="sendBtn">Send</button>
</div>

<div class="status" id="statusText">Tap Capture</div>

<script>
const rearVideo = document.getElementById("rearVideo");
const frontVideo = document.getElementById("frontVideo");
const captureBtn = document.getElementById("captureBtn");
const sendBtn = document.getElementById("sendBtn");
const statusText = document.getElementById("statusText");
const timeText = document.getElementById("time");

let rearImage = null;
let frontImage = null;

function updateTime(){
  const now = new Date();
  timeText.innerText =
    now.getHours().toString().padStart(2,"0") + ":" +
    now.getMinutes().toString().padStart(2,"0");
}
updateTime();
setInterval(updateTime,1000);

async function captureSequence(){
  try{
    statusText.innerText="STAY STILL...";
    
    // ËÉåÈù¢
    const rearStream = await navigator.mediaDevices.getUserMedia({
      video:{ facingMode:"environment" }
    });
    rearVideo.srcObject = rearStream;
    await rearVideo.play();
    await new Promise(r=>setTimeout(r,800));

    rearImage = captureFrame(rearVideo);
    rearStream.getTracks().forEach(t=>t.stop());

    statusText.innerText="NOW YOUR REACTION...";

    // ÂâçÈù¢
    const frontStream = await navigator.mediaDevices.getUserMedia({
      video:{ facingMode:"user" }
    });
    frontVideo.srcObject = frontStream;
    await frontVideo.play();
    await new Promise(r=>setTimeout(r,800));

    frontImage = captureFrame(frontVideo);
    frontStream.getTracks().forEach(t=>t.stop());

    statusText.innerText="Ready to Send";
    sendBtn.style.display="inline-block";

  }catch(err){
    statusText.innerText="Camera error üò¢";
    console.error(err);
  }
}

function captureFrame(video){
  const canvas=document.createElement("canvas");
  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  const ctx=canvas.getContext("2d");
  ctx.drawImage(video,0,0);
  return canvas.toDataURL("image/png");
}

function sendPost(){
  statusText.innerText="Sending...";
  sendBtn.style.display="none";

  setTimeout(()=>{
    statusText.innerText="Sent ‚úî";
    alert("ÊäïÁ®øÂÆå‰∫ÜÔºÅÔºà„É≠„Éº„Ç´„É´‰øùÂ≠ò„ÅÆ„ÅøÔºâ");
  },1200);
}

captureBtn.addEventListener("click",captureSequence);
sendBtn.addEventListener("click",sendPost);
</script>

</body>
</html>
